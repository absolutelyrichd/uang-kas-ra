<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uang Kas RA Tarbiyatul Aulad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Slate, Stone, Amber, with Emerald/Red for status) -->
    <!-- Application Structure Plan: A dashboard-style layout is chosen for optimal usability. It starts with high-level Key Performance Indicators (KPIs) like current balance for a quick overview. This is followed by visual charts (cashflow trend, income vs. expense) to provide deeper context and show performance over time. Finally, a tabbed section offers detailed, granular data (transaction history and payment status) without cluttering the main view. A new section for AI-powered insights has1 been added, allowing users to generate spending analyses and payment reminder drafts using the Gemini API, further enhancing data utility and task automation. New sections for member management and detailed transaction input are added, along with global save/delete options, all powered by Firebase persistence with Google login. -->
    <!-- Visualization & Content Choices:
        - Report Info: Final Saldo -> Goal: Inform -> Viz: KPI Card -> Interaction: None -> Justification: Most critical metric, needs immediate visibility -> Library/Method: HTML/Tailwind.
        - Report Info: Saldo over time -> Goal: Change -> Viz: Line Chart -> Interaction: Hover for tooltip -> Justification: Clearly shows financial health trend -> Library/Method: Chart.js (Canvas).
        - Report Info: Monthly Pemasukan vs. Pengeluaran -> Goal: Compare -> Viz: Bar Chart -> Interaction: Hover for tooltip -> Justification: Easy comparison of monthly financial activity -> Library/Method: Chart.js (Canvas).
        - Report Info: Cashflow log -> Goal: Organize -> Viz: Table -> Interaction: Search, Delete Transaction -> Justification: Allows users to find and manage specific transactions easily -> Library/Method: HTML/Tailwind + JS.
        - Report Info: Member payment status -> Goal: Organize/Compare -> Viz: Table/Grid -> Interaction: Filter by month, Add/Delete Member, **Automatic Payment Status Update based on payer and income transaction** -> Justification: Quick visual check of who has paid, with color-coding for clarity, and full member management, now automated for accuracy with improved input and simplified payment logic -> Library/Method: HTML/Tailwind + JS.
        - Report Info: Spending patterns from cashflow -> Goal: Inform/Analyze -> Viz: AI-generated text summary -> Interaction: Button click with month selection -> Justification: Provides qualitative insights into spending habits beyond raw numbers -> Library/Method: Gemini API (LLM).
        - Report Info: Unpaid members -> Goal: Act/Communicate -> Viz: AI-generated text draft -> Interaction: Button click -> Justification: Automates the creation of polite payment reminders, saving time -> Library/Method: Gemini API (LLM).
        - Report Info: All data persistence -> Goal: Store/Retrieve -> Viz: None -> Interaction: Download JSON, Upload JSON, Clear In-memory Data -> Justification: Essential for long-term data management and portability, now primarily via Firebase. -> Library/Method: Firebase Firestore + File (JSON) via JS Blob/FileReader.
        - Report Info: Detailed Transaction Input -> Goal: Record -> Viz: Form -> Interaction: Input fields, radio buttons, submit button, Payer dropdown -> Justification: Allows granular entry of financial activities with standardized payer selection -> Library/Method: HTML/Tailwind + JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        .tab-button.active {
            border-color: #f59e0b; /* amber-500 */
            color: #f59e0b; /* amber-500 */
            font-weight: 600;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            text-align: left;
        }
        .modal-content.centered-text {
             text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .pagination-button {
            transition: background-color 0.3s ease;
        }
        .pagination-button.active {
            background-color: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }
        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
    <!-- Firebase SDKs - V9 Compatibility (for easier integration with existing code structure) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Uang Kas RA Tarbiyatul Aulad</h1>
            <p class="text-slate-500 mt-2">Semangat!</p>
            <!-- Firebase Login/Logout UI -->
            <div class="mt-4 flex flex-col sm:flex-row justify-center items-center gap-4">
                <div id="authStatus" class="text-slate-600 font-medium">Memuat status autentikasi...</div>
                <button id="signInButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out hidden">
                    Login dengan Google
                </button>
                <button id="signOutButton" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out hidden">
                    Logout
                </button>
            </div>
        </header>

        <main id="appContent" class="hidden"> <!-- Hidden until user logs in -->
            <!-- Section: Key Metrics -->
            <section id="kpi" class="mb-8">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="text-slate-500 font-medium mb-2">Saldo Saat Ini</h3>
                        <p id="currentBalance" class="text-3xl font-bold text-slate-900">Rp 0</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="text-slate-500 font-medium mb-2">Total Pemasukan</h3>
                        <p id="totalIncome" class="text-3xl font-bold text-emerald-600">Rp 0</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="text-slate-500 font-medium mb-2">Total Pengeluaran</h3>
                        <p id="totalExpense" class="text-3xl font-bold text-red-600">Rp 0</p>
                    </div>
                </div>
            </section>

            <!-- Section: Visualizations -->
            <section id="visualizations" class="mb-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="text-lg font-semibold mb-1 text-slate-900">Tren Arus Kas (Saldo)</h3>
                    <p class="text-sm text-slate-500 mb-4">Grafik ini menunjukkan perubahan saldo kas dari waktu ke waktu, memberikan gambaran tentang kesehatan finansial secara keseluruhan.</p>
                    <div class="chart-container">
                        <canvas id="cashflowChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="text-lg font-semibold mb-1 text-slate-900">Pemasukan vs Pengeluaran Bulanan</h3>
                     <p class="text-sm text-slate-500 mb-4">Bandingkan total pemasukan dan pengeluaran setiap bulan untuk melihat pola aktivitas keuangan.</p>
                    <div class="chart-container">
                        <canvas id="monthlyComparisonChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Section: Detailed Data & Tools Tabs -->
            <section id="details" class="mb-8">
                <div class="bg-white rounded-xl border border-slate-200 shadow-sm">
                    <div class="border-b border-slate-200">
                        <nav class="flex space-x-2 p-2" aria-label="Tabs">
                            <button id="tab-transactions" class="tab-button active px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Riwayat Transaksi
                            </button>
                            <button id="tab-payments" class="tab-button px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Status Pembayaran Anggota
                            </button>
                            <button id="tab-member-management" class="tab-button px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Kelola Anggota
                            </button>
                            <button id="tab-data-management" class="tab-button px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Manajemen Data
                            </button>
                            <button id="tab-pdf-settings" class="tab-button px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Pengaturan Laporan PDF
                            </button>
                            <button id="tab-ai-insights" class="tab-button px-4 py-2 text-sm font-medium text-slate-600 rounded-lg border-b-2 border-transparent hover:text-amber-600 focus:outline-none">
                                Insight & Bantuan AI
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Content for 'Riwayat Transaksi' -->
                    <div id="content-transactions" class="p-4 md:p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-900">Detail Semua Transaksi</h3>
                                <p class="text-sm text-slate-500">Gunakan kolom pencarian untuk menemukan transaksi spesifik.</p>
                            </div>
                            <div class="flex w-full sm:w-auto gap-2">
                                <input type="text" id="transactionSearch" placeholder="Cari transaksi..." class="w-full sm:w-auto p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                                <button id="openAddTransactionModalButton" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex-shrink-0">
                                    + Tambah
                                </button>
                            </div>
                        </div>
                        
                        <!-- NEW: Container for transaction cards -->
                        <div id="transactionCardContainer" class="grid grid-cols-1 gap-4">
                            <!-- Cards will be inserted by JavaScript -->
                        </div>
                        <!-- END NEW -->

                        <!-- OLD: The table is removed -->
                        <!-- <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Tanggal</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Keterangan</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Pemasukan</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Pengeluaran</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionTableBody" class="bg-white divide-y divide-slate-200">
                                    Rows will be inserted by JavaScript
                                </tbody>
                            </table>
                        </div> -->
                        
                        <div id="paginationControls" class="flex justify-between items-center mt-4">
                            <!-- Pagination will be rendered here by JavaScript -->
                        </div>
                    </div>

                    <!-- Tab Content for 'Status Pembayaran Anggota' -->
                    <div id="content-payments" class="hidden p-4 md:p-6">
                        <h3 class="text-lg font-semibold mb-1 text-slate-900">Status Pembayaran Iuran Kas</h3>
                        <p class="text-sm text-slate-500 mb-4">Berikut adalah status pembayaran iuran kas per bulan untuk setiap anggota.</p>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-slate-50">
                                    <tr id="paymentTableHeader">
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider sticky left-0 bg-slate-50 z-10">Nama Anggota</th>
                                        <!-- Month headers will be inserted by JavaScript -->
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBody" class="bg-white divide-y divide-slate-200">
                                    <!-- Rows will be inserted by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Tab Content for 'Kelola Anggota' -->
                    <div id="content-member-management" class="hidden p-4 md:p-6">
                        <h3 class="text-lg font-semibold mb-1 text-slate-900">Kelola Anggota</h3>
                        <p class="text-sm text-slate-500 mb-4">Tambahkan, edit, atau hapus anggota yang akan membayar uang kas.</p>
                        <div class="mb-4 flex flex-col sm:flex-row gap-2">
                            <input type="text" id="newMemberName" placeholder="Nama Anggota Baru" class="flex-grow p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                            <button id="addMemberButton" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center">
                                Tambah Anggota
                                <span id="addMemberSpinner" class="loading-spinner hidden"></span>
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nama Anggota</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="memberTableBody" class="bg-white divide-y divide-slate-200">
                                    <!-- Rows will be inserted by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Tab Content for 'Manajemen Data' -->
                    <div id="content-data-management" class="hidden p-4 md:p-6">
                        <h2 class="text-xl font-semibold mb-4 text-slate-900">Manajemen Data</h2>
                        <p class="text-sm text-slate-500 mb-4">Unduh data Anda sebagai file JSON (backup) atau muat data dari file yang sudah ada.</p>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <button id="downloadDataButton" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center">
                                Unduh Data (JSON) üíæ
                            </button>
                            <button id="downloadReportButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center">
                                Unduh Laporan (PDF) üìÑ
                            </button>
                            <input type="file" id="uploadFileInput" accept=".json" class="hidden">
                            <button id="uploadDataButton" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center">
                                Muat Data dari File üìÅ
                            </button>
                            <button id="clearInMemoryDataButton" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center">
                                Hapus Semua Data (Firebase) üóëÔ∏è
                            </button>
                        </div>
                        <div class="flex items-center space-x-2 mb-4">
                            <label for="autoDownloadInterval" class="text-sm font-medium text-slate-700">Unduh Otomatis Backup Lokal Setiap:</label>
                            <select id="autoDownloadInterval" class="p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                                <option value="0" selected>Nonaktif</option> <!-- Default to Nonaktif -->
                                <option value="1">1 Menit</option>
                                <option value="5">5 Menit</option>
                                <option value="10">10 Menit</option>
                                <option value="30">30 Menit</option>
                            </select>
                            <span id="autoDownloadStatus" class="text-sm text-slate-500"></span>
                        </div>
                        <p id="dataManagementMessage" class="mt-4 text-sm text-slate-600"></p>
                    </div>

                    <!-- Tab Content for 'Pengaturan Laporan PDF' -->
                    <div id="content-pdf-settings" class="hidden p-4 md:p-6">
                        <h2 class="text-xl font-semibold mb-4 text-slate-900">Pengaturan Laporan PDF</h2>
                        <p class="text-sm text-slate-500 mb-4">Pilih bulan-bulan yang ingin Anda sertakan dalam bagian "Rincian Perbulan" pada laporan PDF.</p>
                        <div id="pdfMonthSelection" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2">
                            <!-- Month checkboxes will be generated here by JavaScript -->
                        </div>
                        <button id="selectAllPdfMonths" class="mt-4 bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-1 px-3 rounded-lg text-sm transition duration-300 ease-in-out">Pilih Semua</button>
                        <button id="clearAllPdfMonths" class="mt-4 bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-1 px-3 rounded-lg text-sm transition duration-300 ease-in-out ml-2">Hapus Pilihan</button>
                    </div>

                    <!-- Tab Content for 'Insight & Bantuan AI' -->
                    <div id="content-ai-insights" class="hidden p-4 md:p-6">
                        <h2 class="text-xl font-semibold mb-4 text-slate-900">Insight & Bantuan AI</h2>
                        <p class="text-sm text-slate-500 mb-4">Manfaatkan kecerdasan buatan untuk mendapatkan analisis pengeluaran dan draf pengingat pembayaran.</p>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Spending Analysis -->
                            <div>
                                <h3 class="text-lg font-semibold mb-2 text-slate-900">Analisis Pengeluaran Bulanan</h3>
                                <p class="text-sm text-slate-500 mb-3">Pilih bulan untuk mendapatkan ringkasan pola pengeluaran utama Anda.</p>
                                <div class="flex items-center space-x-2 mb-4">
                                    <select id="aiMonthFilter" class="p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                                        <!-- Options will be inserted by JavaScript -->
                                    </select>
                                    <button id="generateSpendingAnalysis" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                                        Dapatkan Analisis Pengeluaran ‚ú®
                                        <span id="spendingAnalysisSpinner" class="loading-spinner hidden"></span>
                                    </button>
                                </div>
                                <div id="spendingAnalysisOutput" class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-slate-700 min-h-[80px] flex items-center justify-center text-center">
                                    <p class="text-slate-500">Hasil analisis akan muncul di sini.</p>
                                </div>
                            </div>
                            <!-- Payment Reminder Draft -->
                            <div>
                                <h3 class="text-lg font-semibold mb-2 text-slate-900">Draf Pengingat Pembayaran</h3>
                                <p class="text-sm text-slate-500 mb-3">Buat draf pesan pengingat untuk anggota yang belum membayar iuran pada bulan yang sedang dipilih di tab "Status Pembayaran".</p>
                                <button id="generatePaymentReminder" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center mb-4">
                                    Buat Draf Pengingat Pengingat ‚ú®
                                    <span id="paymentReminderSpinner" class="loading-spinner hidden"></span>
                                </button>
                                <div id="paymentReminderOutput" class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-slate-700 min-h-[80px] flex items-center justify-center text-center">
                                    <p class="text-slate-500">Draf pesan akan muncul di sini.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden divs for Modals -->
                    <div id="content-input-transaction" class="hidden"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS SECTION -->
    
    <!-- Custom Modal for Confirmation -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content centered-text">
            <span class="close-button">&times;</span>
            <p id="modalMessage" class="text-lg font-medium text-slate-800 mb-6">Apakah Anda yakin?</p>
            <div class="flex justify-center space-x-4">
                <button id="confirmYes" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">Ya</button>
                <button id="confirmNo" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">Tidak</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Editing Member Name -->
    <div id="editMemberModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeEditMemberModal">&times;</span>
            <h3 class="text-lg font-semibold mb-4 text-slate-900">Edit Nama Anggota</h3>
            <input type="text" id="editMemberNameInput" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 mb-4" placeholder="Nama Anggota Baru">
            <div class="flex justify-end space-x-4">
                <button id="cancelEditMemberName" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">Batal</button>
                <button id="saveEditedMemberName" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">Simpan</button>
            </div>
        </div>
    </div>

    <!-- NEW: Modal for Adding a New Transaction -->
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeAddTransactionModal">&times;</span>
            <h3 class="text-lg font-semibold mb-1 text-slate-900">Input Transaksi Baru</h3>
            <p class="text-sm text-slate-500 mb-4">Masukkan detail transaksi pemasukan atau pengeluaran baru.</p>
            <form id="transactionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="transactionDate" class="block text-sm font-medium text-slate-700">Tanggal</label>
                    <input type="date" id="transactionDate" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                <div>
                    <label for="transactionDesc" class="block text-sm font-medium text-slate-700">Keterangan</label>
                    <input type="text" id="transactionDesc" placeholder="Contoh: Pembelian buku kas" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                <div>
                    <label for="transactionAmount" class="block text-sm font-medium text-slate-700">Nominal (Rp)</label>
                    <input type="number" id="transactionAmount" placeholder="Contoh: 50000" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required min="0">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700">Jenis Transaksi</label>
                    <div class="mt-1 flex items-center space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="transactionType" value="pemasukan" class="form-radio text-emerald-600" checked>
                            <span class="ml-2 text-slate-700">Pemasukan</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="transactionType" value="pengeluaran" class="form-radio text-red-600">
                            <span class="ml-2 text-slate-700">Pengeluaran</span>
                        </label>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <label for="transactionWho" class="block text-sm font-medium text-slate-700">Penyetor / Pengambil</label>
                    <select id="transactionWho" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="">Pilih Anggota (Opsional)</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <!-- New fields for multi-month payment -->
                <div class="md:col-span-2">
                    <label for="paymentPeriodStartMonth" class="block text-sm font-medium text-slate-700">Pembayaran Untuk Bulan (Mulai)</label>
                    <select id="paymentPeriodStartMonth" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="">Pilih Bulan (Opsional)</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="paymentPeriodEndMonth" class="block text-sm font-medium text-slate-700">Pembayaran Untuk Bulan (Akhir)</label>
                    <select id="paymentPeriodEndMonth" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="">Pilih Bulan (Opsional)</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <!-- End new fields -->
                <div class="md:col-span-2 flex justify-end">
                    <button type="submit" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                        Tambah Transaksi
                        <span id="addTransactionSpinner" class="loading-spinner hidden"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Modal for Editing an Existing Transaction -->
    <div id="editTransactionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeEditTransactionModal">&times;</span>
            <h3 class="text-lg font-semibold mb-1 text-slate-900">Edit Transaksi</h3>
            <p class="text-sm text-slate-500 mb-4">Ubah detail transaksi yang sudah ada.</p>
            <form id="editTransactionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="editTransactionId">
                <div>
                    <label for="editTransactionDate" class="block text-sm font-medium text-slate-700">Tanggal</label>
                    <input type="date" id="editTransactionDate" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                <div>
                    <label for="editTransactionDesc" class="block text-sm font-medium text-slate-700">Keterangan</label>
                    <input type="text" id="editTransactionDesc" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                <div>
                    <label for="editTransactionAmount" class="block text-sm font-medium text-slate-700">Nominal (Rp)</label>
                    <input type="number" id="editTransactionAmount" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" required min="0">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700">Jenis Transaksi</label>
                    <div class="mt-1 flex items-center space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="editTransactionType" value="pemasukan" class="form-radio text-emerald-600">
                            <span class="ml-2 text-slate-700">Pemasukan</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="editTransactionType" value="pengeluaran" class="form-radio text-red-600">
                            <span class="ml-2 text-slate-700">Pengeluaran</span>
                        </label>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <label for="editTransactionWho" class="block text-sm font-medium text-slate-700">Penyetor / Pengambil</label>
                    <select id="editTransactionWho" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <!-- ADDED: Fields for editing multi-month payment -->
                <div class="md:col-span-2">
                    <label for="editPaymentPeriodStartMonth" class="block text-sm font-medium text-slate-700">Pembayaran Untuk Bulan (Mulai)</label>
                    <select id="editPaymentPeriodStartMonth" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="">Pilih Bulan (Opsional)</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="editPaymentPeriodEndMonth" class="block text-sm font-medium text-slate-700">Pembayaran Untuk Bulan (Akhir)</label>
                    <select id="editPaymentPeriodEndMonth" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="">Pilih Bulan (Opsional)</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <!-- End added fields -->
                <div class="md:col-span-2 flex justify-end space-x-4">
                     <button type="button" id="cancelEditTransaction" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                        Simpan Perubahan
                        <span id="editTransactionSpinner" class="loading-spinner hidden"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script type="module" src="/script.js"></script>
</body>
</html>
